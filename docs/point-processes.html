<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Point processes | Introduction to spatial statistics in R</title>
  <meta name="description" content="5 Point processes | Introduction to spatial statistics in R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Point processes | Introduction to spatial statistics in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ucdavisdatalab.github.io/workshop-spatial-stats/" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/YOUR_REPO" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Point processes | Introduction to spatial statistics in R" />
  
  
  

<meta name="author" content="Wesley Brooks" />


<meta name="date" content="2021-05-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="areal-data.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Introduction to spatial statistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>1</b> Spatial data</a></li>
<li class="chapter" data-level="2" data-path="random-fields.html"><a href="random-fields.html"><i class="fa fa-check"></i><b>2</b> Random fields</a></li>
<li class="chapter" data-level="3" data-path="geostatistics.html"><a href="geostatistics.html"><i class="fa fa-check"></i><b>3</b> Geostatistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="geostatistics.html"><a href="geostatistics.html#example-rongelap-radiation"><i class="fa fa-check"></i><b>3.1</b> Example: Rongelap radiation</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="geostatistics.html"><a href="geostatistics.html#kriging"><i class="fa fa-check"></i><b>3.1.1</b> Kriging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="geostatistics.html"><a href="geostatistics.html#example-meuse-river-zinc-pollution"><i class="fa fa-check"></i><b>3.2</b> Example: Meuse River zinc pollution</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="geostatistics.html"><a href="geostatistics.html#kriging-the-meuse-data"><i class="fa fa-check"></i><b>3.2.1</b> Kriging the Meuse data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="areal-data.html"><a href="areal-data.html"><i class="fa fa-check"></i><b>4</b> Areal data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="areal-data.html"><a href="areal-data.html#example-north-carolina-sids"><i class="fa fa-check"></i><b>4.1</b> Example: North Carolina SIDS</a></li>
<li class="chapter" data-level="4.2" data-path="areal-data.html"><a href="areal-data.html#neighbor-weighting"><i class="fa fa-check"></i><b>4.2</b> Neighbor weighting</a></li>
<li class="chapter" data-level="4.3" data-path="areal-data.html"><a href="areal-data.html#morans-i"><i class="fa fa-check"></i><b>4.3</b> Moran’s I</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="point-processes.html"><a href="point-processes.html"><i class="fa fa-check"></i><b>5</b> Point processes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="point-processes.html"><a href="point-processes.html#import-and-plot-valley-oak-locations"><i class="fa fa-check"></i><b>5.1</b> Import and plot valley oak locations</a></li>
<li class="chapter" data-level="5.2" data-path="point-processes.html"><a href="point-processes.html#poisson-point-process"><i class="fa fa-check"></i><b>5.2</b> Poisson point process</a></li>
<li class="chapter" data-level="5.3" data-path="point-processes.html"><a href="point-processes.html#ripleys-k"><i class="fa fa-check"></i><b>5.3</b> Ripley’s K</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial statistics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="point-processes" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Point processes</h1>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="point-processes.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;spatstat&quot;</span> )</span>
<span id="cb41-2"><a href="point-processes.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;sf&quot;</span> )</span>
<span id="cb41-3"><a href="point-processes.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;tigris&quot;</span> )</span>
<span id="cb41-4"><a href="point-processes.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;dplyr&quot;</span> )</span>
<span id="cb41-5"><a href="point-processes.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;readr&quot;</span> )</span>
<span id="cb41-6"><a href="point-processes.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;ggplot2&quot;</span> )</span></code></pre></div>
<div id="import-and-plot-valley-oak-locations" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Import and plot valley oak locations</h2>
<p>To introduce point patterns, I will use data from iNaturalist on the locations of valley oaks in Sacramento County. First, we will import the data and the Sac county shapefile.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="point-processes.html#cb42-1" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="st">&quot;data/oak.csv&quot;</span> )</span>
<span id="cb42-2"><a href="point-processes.html#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="point-processes.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert oak to an sf object</span></span>
<span id="cb42-4"><a href="point-processes.html#cb42-4" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">=</span> <span class="fu">st_as_sf</span>( oak, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span> ), <span class="at">crs =</span> <span class="st">&quot;epsg:4326&quot;</span> )</span>
<span id="cb42-5"><a href="point-processes.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="point-processes.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># project oaks to California Albers</span></span>
<span id="cb42-7"><a href="point-processes.html#cb42-7" aria-hidden="true" tabindex="-1"></a>oak <span class="ot">=</span> <span class="fu">st_transform</span>( oak, <span class="at">crs =</span> <span class="st">&quot;epsg:6414&quot;</span> )</span></code></pre></div>
<p>Now, let’s plot the points.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="point-processes.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load sac county shape</span></span>
<span id="cb43-2"><a href="point-processes.html#cb43-2" aria-hidden="true" tabindex="-1"></a>cty <span class="ot">=</span> <span class="fu">counties</span>()</span>
<span id="cb43-3"><a href="point-processes.html#cb43-3" aria-hidden="true" tabindex="-1"></a>saccty <span class="ot">=</span> <span class="fu">filter</span>( cty, NAME <span class="sc">==</span> <span class="st">&quot;Sacramento&quot;</span> )</span>
<span id="cb43-4"><a href="point-processes.html#cb43-4" aria-hidden="true" tabindex="-1"></a>saccty <span class="ot">=</span> <span class="fu">st_transform</span>( saccty, <span class="at">crs =</span> <span class="st">&quot;epsg:6414&quot;</span> )</span>
<span id="cb43-5"><a href="point-processes.html#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="point-processes.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the oak locations in Sac county</span></span>
<span id="cb43-7"><a href="point-processes.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(saccty) <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data=</span>oak) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="05_point-patterns_files/figure-html/plot-oaks-1.png" width="672" /></p>
</div>
<div id="poisson-point-process" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Poisson point process</h2>
<p>The Poisson point process is a very simple point process that assumes that if you draw any square on the region, then the number of points inside the square should follow a Poisson distribution, with the expected number of points only depending on the area of the square.</p>
<p>Based on the clustering of valley oaks (mostly around the American River), it looks like the number of trees would depend on the location of the square, not just its size. That would imply that this is not a simple Poisson point process. Let’s back up that eye test by looking at Ripley’s K function - a measure of how clustered or dispersed the points are. Either clustering or disepersion would be a violation of the Poisson assumptions. Begin by converting the point locations into a <code>ppp</code> object (<code>spatstat</code> package).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="point-processes.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the locations of the oaks and the bounds of the county</span></span>
<span id="cb44-2"><a href="point-processes.html#cb44-2" aria-hidden="true" tabindex="-1"></a>oak_locs <span class="ot">=</span> <span class="fu">st_coordinates</span>( oak )</span>
<span id="cb44-3"><a href="point-processes.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="point-processes.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># turn the oak locations into a Poisson point pattern:</span></span>
<span id="cb44-5"><a href="point-processes.html#cb44-5" aria-hidden="true" tabindex="-1"></a>oak_pts <span class="ot">=</span> <span class="fu">ppp</span>( oak_locs[, <span class="dv">1</span>], oak_locs[, <span class="dv">2</span>], <span class="at">window =</span> <span class="fu">as.owin</span>( saccty ) )</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
</div>
<div id="ripleys-k" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Ripley’s K</h2>
<p>Now calculate the Ripley’s K function, and just for fun I’ll include an estimated density showing hotspots (this density estimate is over-simple but still suggestive.)</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="point-processes.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the point pattern:</span></span>
<span id="cb46-2"><a href="point-processes.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( oak_pts )</span></code></pre></div>
<p><img src="05_point-patterns_files/figure-html/plot-ppp-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="point-processes.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the points follow a Poisson distribution (no)</span></span>
<span id="cb47-2"><a href="point-processes.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="fu">Kest</span>( oak_pts ) )</span></code></pre></div>
<p><img src="05_point-patterns_files/figure-html/plot-ppp-2.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="point-processes.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="fu">envelope</span>( oak_pts, Kest))</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2,  [etd 7:46] 3,  [etd 6:45] 4,
##  [etd 6:38] 5,  [etd 6:50] 6,  [etd 6:38] 7,  [etd 6:42] 8,
##  [etd 6:37] 9,  [etd 6:20] 10,  [etd 6:21] 11,  [etd 7:13] 12,
##  [etd 7:00] 13,  [etd 6:46] 14,  [etd 6:35] 15,  [etd 6:23] 16,
##  [etd 6:14] 17,  [etd 6:05] 18,  [etd 5:58] 19,  [etd 5:50] 20,
##  [etd 5:48] 21,  [etd 5:45] 22,  [etd 5:38] 23,  [etd 5:28] 24,
##  [etd 5:25] 25,  [etd 5:24] 26,  [etd 5:20] 27,  [etd 5:14] 28,
##  [etd 5:08] 29,  [etd 5:00] 30,  [etd 4:53] 31,  [etd 4:48] 32,
##  [etd 4:44] 33,  [etd 4:39] 34,  [etd 4:35] 35,  [etd 4:28] 36,
##  [etd 4:23] 37,  [etd 4:18] 38,  [etd 4:13] 39,  [etd 4:09] 40,
##  [etd 4:06] 41,  [etd 4:02] 42,  [etd 3:58] 43,  [etd 3:53] 44,
##  [etd 3:49] 45,  [etd 3:44] 46,  [etd 3:40] 47,  [etd 3:35] 48,
##  [etd 3:31] 49,  [etd 3:26] 50,  [etd 3:22] 51,  [etd 3:18] 52,
##  [etd 3:13] 53,  [etd 3:09] 54,  [etd 3:05] 55,  [etd 3:01] 56,
##  [etd 2:57] 57,  [etd 2:52] 58,  [etd 2:47] 59,  [etd 2:44] 60,
##  [etd 2:39] 61,  [etd 2:35] 62,  [etd 2:31] 63,  [etd 2:27] 64,
##  [etd 2:22] 65,  [etd 2:18] 66,  [etd 2:14] 67,  [etd 2:10] 68,
##  [etd 2:06] 69,  [etd 2:02] 70,  [etd 1:57] 71,  [etd 1:53] 72,
##  [etd 1:49] 73,  [etd 1:45] 74,  [etd 1:40] 75,  [etd 1:36] 76,
##  [etd 1:32] 77,  [etd 1:28] 78,  [etd 1:24] 79,  [etd 1:20] 80,
##  [etd 1:16] 81,  [etd 1:12] 82,  [etd 1:08] 83,  [etd 1:04] 84,
##  [etd 1:00] 85,  [etd 55 sec] 86,  [etd 51 sec] 87,  [etd 47 sec] 88,
##  [etd 43 sec] 89,  [etd 39 sec] 90,  [etd 35 sec] 91,  [etd 32 sec] 92,
##  [etd 28 sec] 93,  [etd 24 sec] 94,  [etd 20 sec] 95,  [etd 16 sec] 96,
##  [etd 12 sec] 97,  [etd 8 sec] 98,  [etd 4 sec]  99.
## 
## Done.</code></pre>
<p><img src="05_point-patterns_files/figure-html/plot-ppp-3.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="point-processes.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the estimated isotropic density:</span></span>
<span id="cb50-2"><a href="point-processes.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="fu">density</span>( oak_pts ) )</span></code></pre></div>
<p><img src="05_point-patterns_files/figure-html/plot-ppp-4.png" width="672" /></p>
<p>The observed K-function lies entirely above the plausible envelope that would imply a simple Poisson point process. Above the theoretical K means the points are clustered (below would mean dispersed).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="areal-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop-spatial-stats/edit/master/05_point-patterns.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop-spatial-stats/blob/master/05_point-patterns.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>

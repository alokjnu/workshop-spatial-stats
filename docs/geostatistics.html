<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Geostatistics | Introduction to spatial statistics in R</title>
  <meta name="description" content="3 Geostatistics | Introduction to spatial statistics in R" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Geostatistics | Introduction to spatial statistics in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ucdavisdatalab.github.io/workshop-spatial-stats/" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/YOUR_REPO" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Geostatistics | Introduction to spatial statistics in R" />
  
  
  

<meta name="author" content="Wesley Brooks" />


<meta name="date" content="2021-05-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="random-fields.html"/>
<link rel="next" href="areal-data.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">Introduction to spatial statistics in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>1</b> Spatial data</a></li>
<li class="chapter" data-level="2" data-path="random-fields.html"><a href="random-fields.html"><i class="fa fa-check"></i><b>2</b> Random fields</a></li>
<li class="chapter" data-level="3" data-path="geostatistics.html"><a href="geostatistics.html"><i class="fa fa-check"></i><b>3</b> Geostatistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="geostatistics.html"><a href="geostatistics.html#example-rongelap-radiation"><i class="fa fa-check"></i><b>3.1</b> Example: Rongelap radiation</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="geostatistics.html"><a href="geostatistics.html#kriging"><i class="fa fa-check"></i><b>3.1.1</b> Kriging</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="geostatistics.html"><a href="geostatistics.html#example-meuse-river-zinc-pollution"><i class="fa fa-check"></i><b>3.2</b> Example: Meuse River zinc pollution</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="geostatistics.html"><a href="geostatistics.html#kriging-the-meuse-data"><i class="fa fa-check"></i><b>3.2.1</b> Kriging the Meuse data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="areal-data.html"><a href="areal-data.html"><i class="fa fa-check"></i><b>4</b> Areal data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="areal-data.html"><a href="areal-data.html#example-north-carolina-sids"><i class="fa fa-check"></i><b>4.1</b> Example: North Carolina SIDS</a></li>
<li class="chapter" data-level="4.2" data-path="areal-data.html"><a href="areal-data.html#neighbor-weighting"><i class="fa fa-check"></i><b>4.2</b> Neighbor weighting</a></li>
<li class="chapter" data-level="4.3" data-path="areal-data.html"><a href="areal-data.html#morans-i"><i class="fa fa-check"></i><b>4.3</b> Moran’s I</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="point-processes.html"><a href="point-processes.html"><i class="fa fa-check"></i><b>5</b> Point processes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="point-processes.html"><a href="point-processes.html#import-and-plot-valley-oak-locations"><i class="fa fa-check"></i><b>5.1</b> Import and plot valley oak locations</a></li>
<li class="chapter" data-level="5.2" data-path="point-processes.html"><a href="point-processes.html#poisson-point-process"><i class="fa fa-check"></i><b>5.2</b> Poisson point process</a></li>
<li class="chapter" data-level="5.3" data-path="point-processes.html"><a href="point-processes.html#ripleys-k"><i class="fa fa-check"></i><b>5.3</b> Ripley’s K</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to spatial statistics in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geostatistics" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Geostatistics</h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="geostatistics.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;gstat&quot;</span> )</span>
<span id="cb11-2"><a href="geostatistics.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;stars&quot;</span> )</span>
<span id="cb11-3"><a href="geostatistics.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;readr&quot;</span> )</span>
<span id="cb11-4"><a href="geostatistics.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( <span class="st">&quot;ggplot2&quot;</span> )</span></code></pre></div>
<div id="example-rongelap-radiation" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Example: Rongelap radiation</h2>
<p>To illustrate basic concepts of geostatistics, I will use measurements of gamma rays on Rongelap atoll, which was irradiated by fallout in 1954 due to the Castle Bravo nuclear test at Bikini atoll, which was three times as powerful as planned. Let’s load the data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="geostatistics.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the point data</span></span>
<span id="cb12-2"><a href="geostatistics.html#cb12-2" aria-hidden="true" tabindex="-1"></a>rongelap <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/ucdavisdatalab/workshop-spatial-stats/master/data/rongelap.csv&quot;</span>) )</span>
<span id="cb12-3"><a href="geostatistics.html#cb12-3" aria-hidden="true" tabindex="-1"></a>rongelap <span class="ot">=</span> <span class="fu">st_as_sf</span>( rongelap, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>) )</span>
<span id="cb12-4"><a href="geostatistics.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="geostatistics.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load the outline of the island</span></span>
<span id="cb12-6"><a href="geostatistics.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>( <span class="fu">url</span>(<span class="st">&quot;https://github.com/ucdavisdatalab/workshop-spatial-stats/blob/master/data/rongelap-outline.rdata?raw=true&quot;</span>) )</span></code></pre></div>
<p>Let’s check the histogram, which suggests that a log transformation will help stabilize the variance. Then plot the data over the shape of Rongelap (you’ve seen this already).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="geostatistics.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the histogram to see about a log transform</span></span>
<span id="cb13-2"><a href="geostatistics.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>( rongelap, <span class="fu">hist</span>(val) )</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/plot-rongelap-data-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="geostatistics.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>( rongelap, <span class="fu">hist</span>( <span class="fu">log</span>(val) ))</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/plot-rongelap-data-2.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="geostatistics.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data on a two-way gradient to exaggerate differences</span></span>
<span id="cb15-2"><a href="geostatistics.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rongelap_shp) <span class="sc">+</span></span>
<span id="cb15-3"><a href="geostatistics.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb15-4"><a href="geostatistics.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>rongelap, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">color=</span><span class="fu">log</span>(val))) <span class="sc">+</span></span>
<span id="cb15-5"><a href="geostatistics.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">10</span>), <span class="at">midpoint=</span><span class="fl">7.5</span>, <span class="at">low=</span><span class="st">&quot;blue&quot;</span>, <span class="at">high=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/plot-rongelap-data-3.png" width="672" /></p>
<div id="kriging" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Kriging</h3>
<p>The fundamental method of geostatistical analysis is kriging (named for a South African mining engineer who invented it). To do kriging, we predict the gamma rays at unobserved locations based on a model of the field’s mean and variance functions. To begin with, I’ll assume the mean is constant and the variance function is exponential (which is the model we saw before).</p>
<p>The predictions are made at held-out locations so that we can compare them to the actual, observed values.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="geostatistics.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hold out some observations from the rongelap data set</span></span>
<span id="cb16-2"><a href="geostatistics.html#cb16-2" aria-hidden="true" tabindex="-1"></a>indx <span class="ot">=</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rongelap), <span class="dv">30</span> )</span>
<span id="cb16-3"><a href="geostatistics.html#cb16-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> rongelap[ <span class="sc">-</span>indx, ]</span>
<span id="cb16-4"><a href="geostatistics.html#cb16-4" aria-hidden="true" tabindex="-1"></a>r3 <span class="ot">=</span> rongelap[ indx, ]</span>
<span id="cb16-5"><a href="geostatistics.html#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="geostatistics.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make a kriging model</span></span>
<span id="cb16-7"><a href="geostatistics.html#cb16-7" aria-hidden="true" tabindex="-1"></a>rongelap_fit <span class="ot">=</span> <span class="fu">krige</span>(<span class="fu">log</span>(val) <span class="sc">~</span> <span class="dv">1</span>, r2, r3, <span class="at">model=</span><span class="fu">vgm</span>(<span class="fl">0.5</span>, <span class="st">&quot;Exp&quot;</span>, <span class="dv">500</span>, <span class="fl">0.05</span>))</span></code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="geostatistics.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the result</span></span>
<span id="cb18-2"><a href="geostatistics.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rongelap_shp) <span class="sc">+</span></span>
<span id="cb18-3"><a href="geostatistics.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="geostatistics.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data=</span>rongelap_fit, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">color=</span>var1.pred)) <span class="sc">+</span></span>
<span id="cb18-5"><a href="geostatistics.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">10</span>), <span class="at">midpoint=</span><span class="fl">7.5</span>, <span class="at">low=</span><span class="st">&quot;blue&quot;</span>, <span class="at">high=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/rongelap-kriging-1.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="geostatistics.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the fitted to the actual</span></span>
<span id="cb19-2"><a href="geostatistics.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( rongelap_fit<span class="sc">$</span>var1.pred, <span class="fu">log</span>(r3<span class="sc">$</span>val), <span class="at">bty=</span><span class="st">&#39;n&#39;</span> )</span>
<span id="cb19-3"><a href="geostatistics.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/rongelap-kriging-2.png" width="672" /></p>
</div>
</div>
<div id="example-meuse-river-zinc-pollution" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Example: Meuse River zinc pollution</h2>
<p>OK, now another geostatistical data set. This time, the data are measurements of pollution in digs within a bend of the Meuse River in northern France. We will focus on zinc pollution. First thing is to load and transform the data:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="geostatistics.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the meuse data</span></span>
<span id="cb20-2"><a href="geostatistics.html#cb20-2" aria-hidden="true" tabindex="-1"></a>meuse <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/ucdavisdatalab/workshop-spatial-stats/master/data/meuse.csv&quot;</span>) )</span>
<span id="cb20-3"><a href="geostatistics.html#cb20-3" aria-hidden="true" tabindex="-1"></a>meuse <span class="ot">=</span> <span class="fu">st_as_sf</span>( meuse, <span class="at">coords=</span><span class="fu">c</span>( <span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>) )</span>
<span id="cb20-4"><a href="geostatistics.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="geostatistics.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the zinc concentration for a possible log transform</span></span>
<span id="cb20-6"><a href="geostatistics.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>( meuse, <span class="fu">hist</span>(zinc) )</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/load-meuse-data-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="geostatistics.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>( meuse, <span class="fu">hist</span>( <span class="fu">log</span>(zinc) ))</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/load-meuse-data-2.png" width="672" /></p>
<p>Now let’s plot the zinc concentration. It looks like the most intense pollution is along the river itself.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="geostatistics.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bubble plot of the Meuse River zinc data</span></span>
<span id="cb22-2"><a href="geostatistics.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meuse) <span class="sc">+</span> <span class="fu">geom_sf</span>( <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size=</span>zinc), <span class="at">color=</span><span class="st">&quot;green&quot;</span>, <span class="at">alpha=</span><span class="fl">0.6</span>)</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/plot-meuse-data-1.png" width="672" /></p>
<div id="kriging-the-meuse-data" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Kriging the Meuse data</h3>
<p>Once again, we will use kriging to predict the zinc pollution in locations where no soil samples were taken. Recall that kriging estimates the random field via the mean and covariance functions. This time, rather than providing a pre-specified covariance function, I am going to estimate it. And I will estimate the mean as not constant, but as a function of distance from the river.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="geostatistics.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a variogram of the meuse data</span></span>
<span id="cb23-2"><a href="geostatistics.html#cb23-2" aria-hidden="true" tabindex="-1"></a>vario <span class="ot">=</span> <span class="fu">variogram</span>( <span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="fu">sqrt</span>(dist), <span class="at">data=</span>meuse )</span>
<span id="cb23-3"><a href="geostatistics.html#cb23-3" aria-hidden="true" tabindex="-1"></a>vario_fit <span class="ot">=</span> <span class="fu">fit.variogram</span>( vario, <span class="at">model =</span> <span class="fu">vgm</span>(<span class="dv">1</span>, <span class="st">&quot;Exp&quot;</span>, <span class="dv">900</span>, <span class="dv">1</span>))</span>
<span id="cb23-4"><a href="geostatistics.html#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="geostatistics.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># show the fitted variogram and its parameters:</span></span>
<span id="cb23-6"><a href="geostatistics.html#cb23-6" aria-hidden="true" tabindex="-1"></a>vario_fit</span></code></pre></div>
<pre><code>##   model      psill    range
## 1   Nug 0.05712112   0.0000
## 2   Exp 0.17641525 340.3105</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="geostatistics.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( vario, vario_fit )</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/meuse-variogram-1.png" width="672" /></p>
<p>That’s our estimated covariance function. Now let’s make predictions at the locations specified in <code>meuse.grid</code> and plot them.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="geostatistics.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the prediction locations</span></span>
<span id="cb26-2"><a href="geostatistics.html#cb26-2" aria-hidden="true" tabindex="-1"></a>meuse.grid <span class="ot">=</span> <span class="fu">read_csv</span>( <span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/ucdavisdatalab/workshop-spatial-stats/master/data/meuse.grid.csv&quot;</span>) )</span>
<span id="cb26-3"><a href="geostatistics.html#cb26-3" aria-hidden="true" tabindex="-1"></a>meuse.grid <span class="ot">=</span> <span class="fu">st_as_sf</span>( meuse.grid, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>) )</span>
<span id="cb26-4"><a href="geostatistics.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="geostatistics.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># regression kriging for the log zinc concentration:</span></span>
<span id="cb26-6"><a href="geostatistics.html#cb26-6" aria-hidden="true" tabindex="-1"></a>meuse_fit <span class="ot">=</span> <span class="fu">krige</span>( <span class="fu">log</span>(zinc) <span class="sc">~</span> <span class="fu">sqrt</span>(dist), meuse, meuse.grid, <span class="at">model=</span>vario_fit)</span>
<span id="cb26-7"><a href="geostatistics.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( meuse_fit ) <span class="sc">+</span></span>
<span id="cb26-8"><a href="geostatistics.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="at">mapping =</span> <span class="fu">aes</span>( <span class="at">color=</span>var1.pred )) <span class="sc">+</span></span>
<span id="cb26-9"><a href="geostatistics.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low=</span><span class="fu">grey</span>(<span class="fl">0.7</span>), <span class="at">high=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="geostatistics.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/meuse-kriging-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="geostatistics.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the uncertainty of the kriging estimator</span></span>
<span id="cb27-2"><a href="geostatistics.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( meuse_fit ) <span class="sc">+</span></span>
<span id="cb27-3"><a href="geostatistics.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="at">mapping =</span> <span class="fu">aes</span>( <span class="at">color=</span>var1.var )) <span class="sc">+</span></span>
<span id="cb27-4"><a href="geostatistics.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low=</span><span class="fu">grey</span>(<span class="fl">0.7</span>), <span class="at">high=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="geostatistics.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="03_geostatistics_files/figure-html/meuse-kriging-2.png" width="672" /></p>
<p>Note that the estimated concentration is greatest near the river, and the uncertainty of the predictions grows as you get farther away from measured data.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="random-fields.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="areal-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop-spatial-stats/edit/master/03_geostatistics.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop-spatial-stats/blob/master/03_geostatistics.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
